---
#
# Copyright (c) 2019 Wind River Systems, Inc.
#
# SPDX-License-Identifier: Apache-2.0
#
# SUB-TASKS DESCRIPTOIN:
#   Validate addresses in provided range and the range size
#

- name: Validate {{ network }} start and end addreses
  debug:
    msg: "{{ network }}: {{ start_addr }} {{ end_addr }}"
  failed_when: (start_addr | ipaddr == False) or (end_addr | ipaddr == False)

- name: Validate {{ network }} start and end range
  vars:
    script_content: |
      from netaddr import IPAddress
      from netaddr import IPRange
      start = IPAddress("{{ start_addr }}")
      end = IPAddress("{{ end_addr }}")
      if not start < end:
        raise Exception("Failed validation, start address must be less than end address.")
      range = IPRange("{{ start_addr }}", "{{ end_addr }}")
      if range.size < {{ minimum_pxeboot_addresses|int }} and {{ network }} == 'pxeboot':
        raise Exception("Failed validation, address range must contain at least %d addresses." %
                        int("{{ minimum_pxeboot_addresses }}"))
  shell: "{{ script_content }}"
  args:
    executable: /usr/bin/python
  #failed_when: false
  #register: password_validation_result
  when: network != 'oam_node'
